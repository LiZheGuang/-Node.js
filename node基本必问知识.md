### node准备工作


[toc]

*******

* node的特点
    * 异步IO
    * 单线程
    * 跨平台
    * 前后端编程语言的统一
    * 工具类应用
* 单线程的缺点
    * 无法利用多核CPU
    * 错误会引起整个应用的退出
    * 大量计算占用CPU无法继续调用异步IO
    * 解决方案：
        * node提供了子进程的概念
* 对于javascript自身而言，它的规范依然包若，还有以下的缺陷
    * 没有模块系统
    * 标准库较少
    * 没有标准接口
    * 缺乏包管理系统


***

#### Node 的模块实现

    Node在实现中并非完全按照实现，尽管规范中 exports,require和module 听起来十分简单，但是node在实现他们的过程中经历了。
     
* 在node中引入模块，需要经历如下3个步骤
    * 路径分析
    * 文件定位
    * 编译执行
* 在node中，模块分为两类：一类是node提供的模块，称为核心模块；
* 另一类是用户编写的模块，称为文件模块
* 简洁以下 以上的问题
    * 核心模块（node自身的）
    * 文件模块

**node 的模块会优先从缓存加载**

* * *

### 模块编译过程总结

**核心模块编译过程中经过了头尾包装的过程**
有些模块是C++来编写，有些则是由C++完成核心部分，其他部分择优javascript实现包装或向外导出。

#### 内建模块的优势
* 本身是由C/C++编写，性能上高于脚本语言
* 在文件被编译时，它被编译成二进制文件，一旦node执行，在直接被加载进内存中。

#### 前后端模块的侧重点
![12078c89e5b5ad49eced67b3452b58fe.png](evernotecid://EBC06249-D6A1-4732-BCC4-49915E428FC6/appyinxiangcom/12846741/ENResource/p188)

前后端javascript分别搁置在HTTP的两端，它们扮演的角色并不同。浏览器端的Javascript需要经历从同一个服务器端分发到多个客户端执行，而服务端的javascript则是相同的代码多次执行，前者的瓶颈在于带宽，后者的瓶颈在于CPU和内存等资源。
前者需要通过网络加载代码，后者从磁盘中加载，两者的加载不在一个数量级上。

### 异步IO小结

从前面实现的异步IO过程描述中，我们可以提取出几个异步IO的关键字

* 单线程
* 事件循环
* 观察者
* IO线程池

> 在node中，除了JavaScript是单线程外，node自身其实是多线程
> 除了用户的代码无法并行执行外，所有的IO操作则是可以并行起来的

#### 总结
   时间循环是异步实现的核心，它与浏览器中的执行模型基本保持了一致。
   
### NODE与v8
![5fcce6df68995159091d4b840a6c6d6b.png](evernotecid://EBC06249-D6A1-4732-BCC4-49915E428FC6/appyinxiangcom/12846741/ENResource/p191)
#### v8的内存限制

* 在node中通过javascript使用内存时，只能使用部分内存
* 64位操作系统 1.4GB
* 32位操作系统0.7gb
* 这导致node无法直接操作大内存对象
* node在启动时，可以打开内存限制

### 网络编程

> NODE提供了net,dgram,http,https 着4个模块，分别用于处理TCP,UDP,HTTP,HTTPS适用于服务端和客户端

#### TCP
TCP名为**传输控制协议**，在OSI模型（由七层组成，物理层，数据链结层，网络层，传输层，会话层，表示层，应用层）

![58ef920c8d2d629beb347082b2913158.png](evernotecid://EBC06249-D6A1-4732-BCC4-49915E428FC6/appyinxiangcom/12846741/ENResource/p192)


### 内存泄漏

* 用户服务异常
* 进程异常
* 服务器性能异常

### 事物（ACID）


#### 数据库事物的四大特性

* 原子性 atomicity
    * 原子性是指事务包含的所有操作要么全部成功，要么全部失败回滚。
    * 这样避免中间某一部分操作失败不会对数据库造成影响
* 一致性 consistency
    * 事务执行之前和执行之后都必须处于一致性的状态
    * 拿转账来说，假设用户A和用户B两者的钱加起来一共是5000，那么不管A和B之间如何转账，转几次账，事务结束后两个用户的钱相加起来应该还得是5000，这就是事务的一致性。
* 隔离性 isolation
    * 隔离性是当多个用户并发访问数据库，操作数据库，比如操作同一张表，数据库为每个用户开启的事物，不能被其他事物打扰，多个并发事物之间相互隔离
* 持久性 DURability
    * 持久性是指一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作。

### mongoDb

* mongodb在创建索引时，会自动给索引命名！
* 索引名字有长度限制 124字节


#### 索引属性重要的有
* 名字
* 唯一性
* 稀疏性
* 是否定时删除

#### mongodb索引都有哪些？
* _id索引
* 复合索引
* 过期索引
* 全文索引
* 地理空间索引

#### mongodb 索引分析
* mongoStat工具
    * 查看MongoDB运行状态的程序
* profile集合
    * 索引优点：加快索引相关的查询
    * 索引缺点：增加磁盘空间消耗，降低写入性能
![17112272248ef69d4bfb6face4b0738b.png](evernotecid://EBC06249-D6A1-4732-BCC4-49915E428FC6/appyinxiangcom/12846741/ENResource/p193)

### MongoDB安全概念

* 最安全的是物理隔绝 ：不现实
* 网络隔离层 某些网络下可以
* 防火墙隔离 某些ID可以
* 用户密码隔离 最常使用的

鉴权机制用于用户密码隔离，也是最常用的安全隔离方法
